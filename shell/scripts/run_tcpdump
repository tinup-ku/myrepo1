#!/bin/ksh

tcpdump -i eth0 'tcp port 8089 and ((ip host 10.104.203.189) or (ip host 10.104.203.62))' -w dr.pcap


Example 1:
#Source: s0039bdv
# curl -k http://ser13281pdv.dev.mycorp.com:8088/services/collector -H "Authorization: Splunk 48de19d3-4974-4563-bf2a-87df15e6587f" -d '{"event": "Hello, world!", "sourcetype": "manual"}'

#Run tcpdump on Destination
# Destination
# [root@ser13281pdv ~]# tcpdump dst port 8088|grep s0039bdv
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
09:26:06.896790 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [S], seq 645803288, win 29200, options [mss 1460,sackOK,TS val 2966061768 ecr 0,nop,wscale 8], length 0
09:26:06.898246 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [.], ack 184736743, win 115, options [nop,nop,TS val 2966061770 ecr 2052939467], length 0
09:26:06.901160 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [P.], seq 0:292, ack 1, win 115, options [nop,nop,TS val 2966061770 ecr 2052939467], length 292
09:26:06.903597 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [.], ack 275, win 119, options [nop,nop,TS val 2966061775 ecr 2052939472], length 0
09:26:06.903740 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [F.], seq 292, ack 275, win 119, options [nop,nop,TS val 2966061775 ecr 2052939472], length 0
09:26:06.905114 IP s0039bdv.csdev.corp.34938 > ser13281pdv.dev.mycorp.com.radan-http: Flags [.], ack 276, win 119, options [nop,nop,TS val 2966061777 ecr 2052939474], length 0

Example 2:
Destination
[root@s0039bdv splunk]# host s0039bdv
s0039bdv.csdev.corp has address 10.113.132.1
----------------------------------------------------
[root@ser13281pdv ~]# tcpdump -nn|grep '10.113.132.1'
----------------------------------------------------
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes





09:38:54.764002 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [S], seq 4005325488, win 29200, options [mss 1460,sackOK,TS val 2966829635 ecr 0,nop,wscale 8], length 0
09:38:54.764044 IP 10.103.119.163.8088 > 10.113.132.1.35184: Flags [S.], seq 3168085764, ack 4005325489, win 28960, options [mss 1460,sackOK,TS val 2053707335 ecr 2966829635,nop,wscale 7], length 0
09:38:54.765266 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [.], ack 1, win 115, options [nop,nop,TS val 2966829637 ecr 2053707335], length 0
09:38:54.768313 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [P.], seq 1:293, ack 1, win 115, options [nop,nop,TS val 2966829637 ecr 2053707335], length 292
09:38:54.768333 IP 10.103.119.163.8088 > 10.113.132.1.35184: Flags [.], ack 293, win 235, options [nop,nop,TS val 2053707339 ecr 2966829637], length 0
09:38:54.768881 IP 10.103.119.163.8088 > 10.113.132.1.35184: Flags [P.], seq 1:275, ack 293, win 235, options [nop,nop,TS val 2053707339 ecr 2966829637], length 274
09:38:54.771099 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [.], ack 275, win 119, options [nop,nop,TS val 2966829643 ecr 2053707339], length 0
09:38:54.771213 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [F.], seq 293, ack 275, win 119, options [nop,nop,TS val 2966829643 ecr 2053707339], length 0
09:38:54.771274 IP 10.103.119.163.8088 > 10.113.132.1.35184: Flags [F.], seq 275, ack 294, win 235, options [nop,nop,TS val 2053707342 ecr 2966829643], length 0
09:38:54.772419 IP 10.113.132.1.35184 > 10.103.119.163.8088: Flags [.], ack 276, win 119, options [nop,nop,TS val 2966829644 ecr 2053707342], length 0

Example 3:
Source:
[root@CUD1-001559 ~]# curl -k http://ser13281pdv.dev.mycorp.com:8088/services/collector -H "Authorization: Splunk 48de19d3-4974-4563-bf2a-87df15e6587f" -d '{"event": "Hello, world!", "sourcetype": "manual"}'
{"text":"Success","code":0}[root@CUD1-001559 ~]# curl -k http://ser13281pdv.dev.mycorp. -H "Authorization: Splunk 48de19d3-4974-4563-bf2a-87df15e6587f" -d '{"event": "Hello, world!", "sourcetype": "manual"}'
{"text":"Success","code":0}

Destination:
--------------------------------------------------------------
[root@ser13281pdv ~]# tcpdump -nn port 8088|grep '10.113.132.1'
--------------------------------------------------------------
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
09:52:49.525103 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [S], seq 1153883672, win 29200, options [mss 1460,sackOK,TS val 2967664396 ecr 0,nop,wscale 8], length 0
09:52:49.525147 IP 10.103.119.163.8088 > 10.113.132.1.35492: Flags [S.], seq 3924166538, ack 1153883673, win 28960, options [mss 1460,sackOK,TS val 2054542096 ecr 2967664396,nop,wscale 7], length 0
09:52:49.526695 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [.], ack 1, win 115, options [nop,nop,TS val 2967664399 ecr 2054542096], length 0
09:52:49.529576 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [P.], seq 1:293, ack 1, win 115, options [nop,nop,TS val 2967664399 ecr 2054542096], length 292
09:52:49.529597 IP 10.103.119.163.8088 > 10.113.132.1.35492: Flags [.], ack 293, win 235, options [nop,nop,TS val 2054542100 ecr 2967664399], length 0
09:52:49.530219 IP 10.103.119.163.8088 > 10.113.132.1.35492: Flags [P.], seq 1:275, ack 293, win 235, options [nop,nop,TS val 2054542101 ecr 2967664399], length 274
09:52:49.532125 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [.], ack 275, win 119, options [nop,nop,TS val 2967664404 ecr 2054542101], length 0
09:52:49.532305 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [F.], seq 293, ack 275, win 119, options [nop,nop,TS val 2967664404 ecr 2054542101], length 0
09:52:49.532357 IP 10.103.119.163.8088 > 10.113.132.1.35492: Flags [F.], seq 275, ack 294, win 235, options [nop,nop,TS val 2054542103 ecr 2967664404], length 0
09:52:49.533486 IP 10.113.132.1.35492 > 10.103.119.163.8088: Flags [.], ack 276, win 119, options [nop,nop,TS val 2967664405 ecr 2054542103], length 0


Example 3:
On Destination node ser13281pdv:
Only capture on HTTP data packets on port 8088. Avoid capturing the TCP session setup (SYN / FIN / ACK).
[root@ser13281pdv ~]# tcpdump 'tcp port 8088 and (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)'


Example 4:
[root@ser13281pdv ~]# tcpdump -nnSX port 8088

10:05:53.744674 IP 10.103.119.163.8088 > 10.87.48.73.42662: Flags [P.], seq 498421976:498422250, ack 2033974172, win 6970, options [nop,nop,TS val 2055326315 ecr 1419740487], length 274
        0x0000:  4500 0146 4855 4000 4006 34b3 0a67 77a3  E..FHU@.@.4..gw.
        0x0010:  0a57 3049 1f98 a6a6 1db5 50d8 793b fb9c  .W0I......P.y;..
        0x0020:  8018 1b3a bde2 0000 0101 080a 7a81 ca6b  ...:........z..k
        0x0030:  549f 8547 4854 5450 2f31 2e31 2032 3030  T..GHTTP/1.1.200
        0x0040:  204f 4b0d 0a44 6174 653a 2046 7269 2c20  .OK..Date:.Fri,.
        0x0050:  3031 204f 6374 2032 3032 3120 3134 3a30  01.Oct.2021.14:0
        0x0060:  353a 3533 2047 4d54 0d0a 436f 6e74 656e  5:53.GMT..Conten
        0x0070:  742d 5479 7065 3a20 6170 706c 6963 6174  t-Type:.applicat
        0x0080:  696f 6e2f 6a73 6f6e 3b20 6368 6172 7365  ion/json;.charse
        0x0090:  743d 5554 462d 380d 0a58 2d43 6f6e 7465  t=UTF-8..X-Conte
        0x00a0:  6e74 2d54 7970 652d 4f70 7469 6f6e 733a  nt-Type-Options:
        0x00b0:  206e 6f73 6e69 6666 0d0a 436f 6e74 656e  .nosniff..Conten
        0x00c0:  742d 4c65 6e67 7468 3a20 3237 0d0a 5661  t-Length:.27..Va
        0x00d0:  7279 3a20 4175 7468 6f72 697a 6174 696f  ry:.Authorizatio
        0x00e0:  6e0d 0a43 6f6e 6e65 6374 696f 6e3a 204b  n..Connection:.K
        0x00f0:  6565 702d 416c 6976 650d 0a58 2d46 7261  eep-Alive..X-Fra
        0x0100:  6d65 2d4f 7074 696f 6e73 3a20 5341 4d45  me-Options:.SAME
        0x0110:  4f52 4947 494e 0d0a 5365 7276 6572 3a20  ORIGIN..Server:.
        0x0120:  5370 6c75 6e6b 640d 0a0d 0a7b 2274 6578  Splunkd....{"tex
        0x0130:  7422 3a22 5375 6363 6573 7322 2c22 636f  t":"Success","co
        0x0140:  6465 223a 307d                           de":0}
10:05:53.785449 IP 10.87.48.73.42662 > 10.103.119.163.8088: Flags [.], ack 498422250, win 1424, options [nop,nop,TS val 1419740530 ecr 2055326315], length 0
        0x0000:  4500 0034 8fe5 4000 3b06 f334 0a57 3049  E..4..@.;..4.W0I
        0x0010:  0a67 77a3 a6a6 1f98 793b fb9c 1db5 51ea  .gw.....y;....Q.
        0x0020:  8010 0590 eacd 0000 0101 080a 549f 8572  ............T..r
        0x0030:  7a81 ca6b                                z..k
Example 5:
[root@ser13281pdv ~]# tcpdump port 8088
Output:
10:11:24.489792 IP cud1-001560.us.global.mycorp.com.45696 > ser13281pdv.dev.mycorp.com.radan-http: Flags [.], ack 5207, win 1424, options [nop,nop,TS val 2019643712 ecr 2055642038], length 0
10:11:24.489853 IP ser13281pdv.dev.mycorp.com.radan-http > cud1-001560.us.global.mycorp.com.45696: Flags [.], ack 4222702, win 15106, options [nop,nop,TS val 2055657060 ecr 2019628730], length 0



Example 6:
Capture in Hex and ASCII from CUD1-001559 to ser13281pdv port 8088
[root@ser13281pdv ~]# tcpdump -XA -i eth0 'tcp port 8088 and (ip host 10.87.53.70)'

