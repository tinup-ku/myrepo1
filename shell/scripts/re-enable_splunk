#!/bin/ksh
date_=$(date '+%a%H%M_%m%d%Y')
TOS_splunk_team="user1@mycorp.com,user2@mycorp.com,user4@mycorp.com,user3@mycorp.com,SivaKumar.Nakka@mycorp.com,bharat.devagiri@mycorp.com,thirumalesh.vanguri@mycorp.com,ramakrishna.manthri@mycorp.com,madhusudhanreddy.ettedi@mycorp.com"

{
  echo "Re-enable splunk@boot"
  # Cover both systemd and system V init.
  cd /etc/init.d && [[ -x Splunk ]] && mv -f Splunk splunk
  cd /etc/systemd/system && [[ -f Splunkd.service ]] && systemctl enable Splunkd

  status=`show_splunk|awk '/^SPLUNK/{print $NF}'`
  [[ $status != "UP" ]] && {
    echo "Starting splunk"
    start_splunk
  }
} |tee /var/tmp/`basename $0`.${date_}.OUT.$$

mailx -s "$0 output|`uname -n`:/var/tmp/`basename $0`.${date_}.OUT.$$" ${TOS_splunk_team} < /var/tmp/`basename $0`.${date_}.OUT.$$

