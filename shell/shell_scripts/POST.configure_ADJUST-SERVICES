#!/bin/bash -x
#==============================================================================
#Change Log:
#
# When          Who             What
# ----          ---             ----
# 06.21.2012    J. Wu       Ported over from SLES release installer
#
#==============================================================================

echo "Disabling/Enabling services:" >> ${INSTLOG}

function edit_service {
   /sbin/chkconfig $1 2>&1 | grep -q "unknown service"
   if [ $? -eq 0 ]; then
      echo "Service $1 not found" >> ${INSTLOG}
      return 0
   fi
    
   /sbin/chkconfig $1 $2
   if [ $? -ne 0 ]; then
      echo "Can't $2 service $1" >> ${INSTLOG}
      return 1
   fi
}

# Catch any chkconfig issues
EXITCODE=0

DSERVICES="autofs iptables ip6tables"
for i in $DSERVICES; do
    edit_service $i off
    if [ $? -ne 0 ]; then 
	echo "Unable to disable service $i" >> ${INSTLOG}
	EXITCODE=1
    fi
done

ASERVICES="snmpd"
for i in $ASERVICES; do
    edit_service $i on
    if [ $? -ne 0 ]; then 
	echo "Unable to activate service $i" >> ${INSTLOG} 
	EXITCODE=1
    fi
done

if [ $EXITCODE -eq 1 ]; then
    echo "Error with Disabling/Enabling services" >> ${INSTLOG}
    exit 1
fi

exit 0
