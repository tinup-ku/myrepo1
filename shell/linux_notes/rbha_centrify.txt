
how to copy files prod to prod:
Login to souce host with -a account and copy:
[kum394-a@prdtxlvpptapp01 tmp]$ scp txt prdtxlvpptapp03:/var/tmp
Could not create directory '/home/kum394-a/.ssh'.
The authenticity of host 'prdtxlvpptapp03 (10.157.150.117)' can't be established.
ECDSA key fingerprint is SHA256:QyITGdeZTIZTZ3aS9SVvUaZT19rGUN0T2mF5BlZc/U8.
ECDSA key fingerprint is MD5:5f:f9:ab:7a:4a:ba:4e:3d:0a:02:71:ed:ed:7d:a0:7b.
Are you sure you want to continue connecting (yes/no)? yes
txt                                                                                                                            100%    4    10.0KB/s   00:00
[kum394-a@prdtxlvpptapp01 tmp]$

OR:
copy from host to gateway and gateway to host



DEV to Prod:
first copy from dev to gateway and next gateway to prod.



  =============================
How to login using UI:
  go/cps - Login as kum394  ( Next enter code sent in mail )
  Click - systems and search for - prdtxlvulsegw01.associatesys.local
  Right click on host and click Select/Request account, Next screen check the box prod-am
   search for kum394 at upper bar , Next click on kum394-a account and at bottom click on "select"
   copy the putty session details and run it using windows search bar
   ( if you don't want to use local putty then go  "settings" => user preferences and uncheck use local
      client for ssh )


How to login using superputty or putty:
  use host-name as:
         kum394-a@prod-am.ameritrade.com@prdtxlvulsegw01.associatesys.local@punit.kumar@tdameritrade.com@centrifygw.amtd.com

How to ssh:
ssh kum394-a@prod-am.ameritrade.com@prdtxlvulsegw01.associatesys.local@punit.kumar@tdameritrade.com@centrifygw.amtd.com

RBHA issues tshoot:
https://confluence.associatesys.local/display/CRITINFRAFAQ/Host+and+Server+Access+FAQ

   ====
how to use rbha on gateway server: ( this works )
   sudo /app/utils/scripts/sweep --byfile servers_check_patching --command "tail -1 /etc/tda/patch_status" --forkit



   =======

How to find if a server is RBHA: ( check for "Centrify" in zone name if it is there then server is rbha )

centrify zone for a server with rbac:

[kum394-a@prdtxlvptgit01 ~]$ adinfo -z
prod-am.ameritrade.com/Centrify/Zones/Global/Unix

A server without RBAC:

[root@prdtxlvulsegw01 edison]# adinfo -z
prod-am.ameritrade.com/Unix/Zones/prd-admin

    ========

another way to fix rbha on a server:

/app/utils/scripts/sweep --byhost prdedlvpasapp13 --script /root/fix_certs.sh 
/app/utils/scripts/sweep --byhost prdedlvpasapp13 --command "rm -f /opt/ucm/cache/*; puppet agent -t"


Running the rbha class only:
   puppet agent -t --tags ucm::preconfig,ucm::rbha
   puppet agent -t --tags ucm::rbha
   
Try this also in case of error:
   yum reinstall centrifydc


   ==========
running rbha script:

    2  adinfo
    3  python /tmp/rbhalocal.py -d 60331d4910fd51dc802309b29171758b
  ==============
centrify login : go/cps

centrify doc:
    https://confluence.associatesys.local/display/CRITINFRAFAQ/Recommended%3A+Centrify+Portal


centrify zone for a server with rbac:

[kum394-a@prdtxlvptgit01 ~]$ adinfo -z
prod-am.ameritrade.com/Centrify/Zones/Global/Unix

A server without RBAC:

[root@prdtxlvulsegw01 edison]# adinfo -z
prod-am.ameritrade.com/Unix/Zones/prd-admin



  ===================

Centrify role based access:
  centrify will read the data from halo and implement role based access control:
     only sudoers access configured on the prod hosts will be impacted as of now.
     ( Try not to do su - , instead ssh from gateway via root )
           No impact on local accounts
           No impact on ssh keys etc...



==============

What is centrifyDC:
It is a bridging services for unix servers to access microsoft active directory
centrify servers talks to microsoftr AD

Centrify's adclient is running on each unix server ( centrify agent ) for AD integration
adclient is capable of doing AD,LDAP.KErberos and group policy
Complete AD data maps to centrify universal zone
But AD is divided in active directory groups
AD groups maps to ZOnes in centrify

e.g.:
production zone:
  Zone:              prod-am.ameritrade.com/Unix/Zones/prd-admin

Dev zone:
  Zone:              iteclientsys.local/Unix/Zones/dev

Each of centrify zone maps to AD groups

Look for the commands like adquery. adinfo etc.. in the doc active_directory.
they are commands provided by centrify corporation

other commands:  ( to check the ad connectivity )
  # adinfo --test

  ================
centrifydc user issue:

/Stage[main]/Tda_tcserver32::Common/User[tomcat]/home	change from /app/tomcat to /app/tomcat/home failed: Could not set home on user[tomcat]: Execution of '/sbin/usermod -d /app/tomcat/home tomcat' returned 6: usermod: user 'tomcat' does not exist
 
 
This is due to recent change in centrify, tomcat user been added to prd-j2ee zone with home dir as /app/tomcat & default shell as ksh 
Tom – did we get hold of Tech Ops person who made this change ?

  ==

As an interim solution I believe you can add the user to “/etc/centrifydc/users.ignore”.  Same path for groups.ignore and you’ll need to do a “service centrifydc restart” or if el7 a “systemctl restart centrifydc”. I wouldn’t trust my memory lol but those should be the paths. Hope it helps.

 =============

These servers where not able to allow sudo for oracle users. After investigation we found that the below groups been ignored by Centrify shows in below file.  Pls have it enable through puppet build. 

/etc/centrifydc/group.ignore

asmadmin
oper
asmdba
postgres_sudo
oracle_sudo


   ============

What is PAM
what is keberos
what is LDAP
what is SSSD

   ============

The sssd daemon acts as the spider in the web, controlling the login process and more. The login program communicates with the configured pam and nss modules, which in this case are provided by the SSSD package. These modules communicate with the corresponding SSSD responders, which in turn talk to the SSSD Monitor. SSSD looks up the user in the LDAP directory, then contacts the Kerberos KDC for authentication and to aquire tickets.

(PAM and NSS can also talk to LDAP directly using pam_ldap and nss_ldap respectively. However SSSD provides additional functionality.)

Of course, a lot of this depends on how SSSD has been configured; there lots of different scenarios. For example, you can configure SSSD to do authentication directly with LDAP, or authenticate via Kerberos.

The sssd daemon does not actually do much that cannot be done with a system that has been "assembled by hand", but has the advantage that it handles everything in a centralised place. Another important benefit of SSSD is that it caches the credentials, which eases the load on servers and makes it possible to go offline and still login. This way you don't need a local account on the machine for offline authentication.

   =================

They’re entirely different protocols for entirely different purposes. I think the reason that people tend to conflate the two is that Active Directory provides both Kerberos and LDAP services together in the same package.

Short answer:

LDAP is a protocol for accessing directories (like OpenLDAP, or Active Directory). As part of its function, it has the ability to authenticate a connection using a username and password.

Kerberos is an authentication and single sign-on protocol. It lets a process authenticate to an authentication server, which provides a signed and encrypted ticket that the process uses to access resources like files and applications. Because the process can save the ticket and use it to access different applications without requiring the user to reauthenticate, it provides single sign-on.

In the case of Active Directory and some other systems, the usernames and passwords the Kerberos authentication server checks are actually stored in a LDAP directory.

   ===================


